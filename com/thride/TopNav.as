package com.thride{	import com.asual.swfaddress.*;	import com.thride.Global;	import com.thride.NavEvent;		import flash.display.Loader;	import flash.display.MovieClip;	import flash.display.Sprite;		import flash.events.Event;	import flash.events.MouseEvent;		import flash.net.URLRequest;	import flash.net.navigateToURL;		import flash.filters.ColorMatrixFilter;		import flash.text.TextField;	import flash.text.TextFieldAutoSize;		import flash.geom.Rectangle;	import flash.geom.ColorTransform;		import com.dynamicflash.util.Base64;	import com.thride.AudioEvent;	import gs.TweenLite;	import gs.easing.*;	//TweenLite.to(mc, 1, {x:46, y:43, scaleX:1, scaleY:1, rotation:0, alpha:1, tint:0x3399ff, ease:Elastic.easeOut, onComplete:FunctionName });			public class TopNav extends MovieClip	{		private var navMargin:Number = 10;				public  var country:String;				private var xmlList:XMLList;		private var audioList:XMLList;				private var titleImgContainer:Sprite;				public var socialBG:MovieClip;		public var audioBG:MovieClip;		public var topnavBG:MovieClip;		public var audioMC:AudioClip;		public var hitClip:Sprite;				private var registerImg:Sprite;		private var topNavMC:Sprite;		private var socialMC:Sprite;				private var navArr:Array;				private var currentNav:TopNavLink;				public function TopNav()		{						addEventListener(Event.ADDED_TO_STAGE, onAdded);				}				public function init($xmlList:XMLList, $audioList:XMLList)		{			SWFAddress.addEventListener(SWFAddressEvent.CHANGE, addressChange);						topnavBG = this.getChildByName("topnavbg") as MovieClip;			socialBG = this.getChildByName("socialbg") as MovieClip;			audioBG = this.getChildByName("audiobg") as MovieClip;						xmlList = $xmlList;			audioList = $audioList;			country = Global.COUNTRY; 			initNav();			initSocial();			initImages();			initAudio();		}				private function initImages(){						var titlesrc:String = "img/"+country+"/topnav_title.png";			//trace("TopNav-initImages() titlesrce:"+titlesrc);									var titlegfx:Loader = new Loader();			titlegfx.contentLoaderInfo.addEventListener(Event.COMPLETE, animTitle);			titlegfx.load(new URLRequest(titlesrc));		}						///////////////////////////////////////////////AUDIO				private function initAudio()		{			audioMC = new AudioClip();			addChild(audioMC);			audioMC.x = audioBG.x;			audioMC.y = audioBG.y;			audioMC.init(audioList);		}										////////////////////////////////////////////////IMG		private function animTitle(e:Event)		{						titleImgContainer = new Sprite();			addChild(titleImgContainer);			titleImgContainer.addChild(e.currentTarget.content);						var titleMask:MaskAnim = new MaskAnim();			addChild(titleMask);			titleImgContainer.mask = titleMask;						titleImgContainer.addEventListener(MouseEvent.CLICK, homeNavigate);			titleImgContainer.buttonMode = true;						loadRegisterImg();		}				private function loadRegisterImg()		{			var src:String = "img/"+country+"/topnav_register.png";			registerImg = new Sprite();			var img:Loader = new Loader();			img.contentLoaderInfo.addEventListener(Event.COMPLETE, initReg);			img.load(new URLRequest(src));		}				private function initReg(e:Event)		{			addChild(registerImg);			registerImg.x = audioBG.x;			registerImg.addChild(e.currentTarget.content);						var titleMask:MaskAnim = new MaskAnim();			addChild(titleMask);			titleMask.x = registerImg.x;			titleMask.scaleX = .5;			registerImg.mask = titleMask;						registerImg.addEventListener(MouseEvent.CLICK, registerImgAction);			registerImg.buttonMode = true;					}														///////////////////////////////////////////////////NAV				private function initNav()		{			topNavMC = new Sprite();			addChild(topNavMC);			topNavMC.y = topnavBG.y;			navArr = new Array();									var totalNavs:Number = xmlList.elements().length()-1;			//trace("\nINITNAV() ----------------total:"+totalNavs);			for (var i:int = 1; i < totalNavs; i++){				//trace("NAV - "+xmlList.section[i].valueOf());				var navmc:TopNavLink = new TopNavLink(xmlList.section[i].valueOf(), xmlList.section[i].@id, xmlList.section[i].@xml, xmlList.section[i].@asset);				navmc.x = topNavMC.width + navMargin;				navmc.y = 10;				topNavMC.addChild(navmc);								navmc.name = "nav"+i;								if(xmlList.section[i].@enabled == "true"){					navmc.addEventListener(MouseEvent.CLICK, navClick);					navmc.addEventListener(MouseEvent.MOUSE_OVER, navOver);					navmc.addEventListener(MouseEvent.MOUSE_OUT, navOut);					navmc.buttonMode = true;				} else {					navmc.deadAnim();				}								//navArr.push( { clip:navmc, id:xmlList.section[i].@id, xmlurl:xmlList.section[i].@xml } );				navArr.push(navmc);				if(i == (totalNavs-1)) navmc.slant.visible = false;			}						//trace("----------------------------total:"+totalNavs);					}						/////////////////////////////////////////////////SOCIAL				private function initSocial()		{			var iconSpacer:Number = 10;			socialMC = new Sprite();			addChild(socialMC);			socialMC.x = socialBG.x - 20;			socialMC.y = socialBG.y;						var t:icon_twitter = new icon_twitter();			var f:icon_facebook = new icon_facebook();			var b:icon_b = new icon_b();			var r:icon_rss = new icon_rss();						socialMC.addChild(t);			socialMC.addChild(f);			socialMC.addChild(b);			socialMC.addChild(r);						t.x = socialMC.width + iconSpacer;			f.x = socialMC.width + iconSpacer;			b.x = socialMC.width + iconSpacer;			r.x = socialMC.width + iconSpacer;						t.addEventListener(MouseEvent.CLICK, twitterAction); t.buttonMode = true;			f.addEventListener(MouseEvent.CLICK, facebookAction); f.buttonMode = true;			//b.addEventListener(MouseEvent.CLICK, bAction); b.buttonMode = true;			deSaturate(b);			r.addEventListener(MouseEvent.CLICK, rssAction); r.buttonMode = true;		}				function deSaturate(mc:*){		var colorMatrix_array:Array = [0.3, 0.59, 0.11, 0, 0,							0.3, 0.59, 0.11, 0, 0,							0.3, 0.59, 0.11, 0, 0,							0, 0, 0, 0.4, 0];		var colorMatrix_filter:ColorMatrixFilter = new ColorMatrixFilter(colorMatrix_array);		mc.filters = [colorMatrix_filter];		}  								///////////////////////////////////////////////HANDLERS																				///////SOCIAL				private function twitterAction(e:MouseEvent)		{			var url:String = xmlList.@twitter;			dispatchEvent(new NavEvent(NavEvent.LINKOUT, true, true, url));		}		private function facebookAction(e:MouseEvent)		{			var url:String = xmlList.@facebook;			dispatchEvent(new NavEvent(NavEvent.LINKOUT, true, true, url));		}		private function bAction(e:MouseEvent)		{			var url:String = xmlList.@bebo;			dispatchEvent(new NavEvent(NavEvent.LINKOUT, true, true, url));		}		private function rssAction(e:MouseEvent)		{			var url:String = xmlList.@rss;			//dispatchEvent(new NavEvent(NavEvent.LINKOUT, true, true, url));			linkTrack(url);			//navigateToURL(new URLRequest(url), "_blank");		}						private function linkTrack(url:String)		{			//get.php?a=" +  Base64.encode(e.target.link) + "&d=\"THXI Preorder\"&t=\"THXI Preorder\"" + "','" + e.target.text			var sendString:String = Global.LINKTRACK+"?a=" + Base64.encode(url) + "&d=" + Base64.encode(Global.COUNTRY) + "&t=" + Base64.encode("THRIDE");			trace("TRACK:"+sendString);			navigateToURL(new URLRequest(sendString), "_blank");		}				///////NAV				private function homeNavigate(e:MouseEvent)		{			navAction("home");		}						public function navClick(e:MouseEvent)		{			//trace("navClick : "+e.currentTarget.id);			var mc:TopNavLink = e.currentTarget as TopNavLink;			navAction(mc.id);		}												public function navOut(e:MouseEvent)		{			//trace("navOut");			e.currentTarget.outAnim();		}		public function navOver(e:MouseEvent)		{			//trace("navOver");			e.currentTarget.overAnim();		}				///////REGISTER				private function registerImgAction(e:MouseEvent)		{			//trace("REG ACTION");			navAction("register");		}						/////////SWFADDRESS				public function navAction(id:String)		{			if(Global.ISLOADED) SWFAddress.setValue(id);			//trace("TOPNAV/NAVACTION :"+id);			//dispatchEvent(new TopNavEvent(TopNavEvent.NAVCHOICE, true, true, id));					}		private function addressChange(e:SWFAddressEvent)		{			//trace("ADDRESS CHANGE name:"+e.value);			//e.value == "/" ? homeNavigate(null) : navAction(e.value);						var arr:Array = SWFAddress.getPathNames();						trace("TOPNAV --- ADDRESS CHANGE name:"+e.value+" ARR: length:"+arr.length+" vals:"+arr[0]);			if(arr[0] != "home" && arr[0] != "register"){				for(var i:int; i < navArr.length; i++){					if(arr[0] == navArr[i].id && currentNav != navArr[i]){						trace("FOUND:"+navArr[i].id);						navArr[i].overAnim();						if(currentNav){ 							currentNav.addEventListener(MouseEvent.MOUSE_OUT, navOut);							currentNav.outAnim();						}						currentNav = navArr[i];						currentNav.removeEventListener(MouseEvent.MOUSE_OUT, navOut);					}				}			} else {				if(currentNav){ 					currentNav.addEventListener(MouseEvent.MOUSE_OUT, navOut);					currentNav.outAnim();					currentNav = null;				}			}		}				////////CONSTRUCT				private function onAdded(e:Event)		{			hitClip = getChildByName("hit") as Sprite;		}			}}