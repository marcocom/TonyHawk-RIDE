package com.thride.media{	import flash.display.Stage;	import flash.display.Loader;	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.display.DisplayObject;	import flash.display.DisplayObjectContainer;		import flash.events.Event;	import flash.events.MouseEvent;		import flash.net.URLRequest;	import flash.net.URLLoader;		import flash.geom.Point;		import flash.text.TextField;	import flash.text.TextFieldAutoSize;		import flash.utils.Timer;		import flash.geom.Rectangle;		import com.thride.Global;	import com.thride.media.videos.*;	import com.thride.media.screenshots.*;	import gs.TweenLite;	import gs.easing.*;	import com.asual.swfaddress.*;			public class Media extends MovieClip	{						private var xmlList:XMLList;		private var dataXML:XML = new XML();		private var xmlloader:Loader;				private var navArr:Array;		private var elementArr:Array;				private var xmlAsset:String;				private var bgClip:MovieClip;		private var titleClip:MovieClip;		private var contentClip:MovieClip;				private var currentSection:String;		private var currentContent:*;				private var topnavClip:TopNav;						public function Media()		{						addEventListener(Event.ADDED_TO_STAGE, onAdded);					}		////////CONSTRUCT				private function onAdded(e:Event)		{			addEventListener(Event.REMOVED_FROM_STAGE, onRemoved);			bgClip = getChildByName("bgclip") as MovieClip;						titleClip = getChildByName("titledyn") as MovieClip;			contentClip = getChildByName("contentdyn") as MovieClip;			visible = false;		}				public function init($xmlsrc:String)		{									xmlAsset = $xmlsrc;			loadData();		}						///////////////////////////////////BG				private function initBG()		{						loadGraphic(dataXML.title.@asset, titleClip);			topnavClip = new TopNav(dataXML.nav)			addChild(topnavClip);			topnavClip.x = titleClip.x - 10;			topnavClip.y = titleClip.y + 45;									checkDeepLink();					}						private function checkDeepLink()		{						SWFAddress.addEventListener(SWFAddressEvent.CHANGE, addressChange);			var arr:Array = SWFAddress.getPathNames();			trace("--------------------pathnames:"+arr);			if(arr.length == 1){ 				SWFAddress.setValue("media/videos/"+dataXML.videos.elements().length()); 			} else {				refData(arr[1]);			}		}								private function loadGraphic(asset:String, target:MovieClip)		{						var l = new Loader();			function finishload(e:Event){				target.addChild(e.currentTarget.content);				TweenLite.from(target, 1, {alpha:0, ease:Strong.easeOut});			}			l.contentLoaderInfo.addEventListener(Event.COMPLETE, finishload);			l.load(new URLRequest(asset));					}				private function popTxt(txt:String, target:MovieClip)		{			var field:TextField = target.getChildByName("txt") as TextField;			field.htmlText = txt;		}						/////////////////////////////////////HANDLERS														/////////SWFADDRESS				private function addressChange(e:SWFAddressEvent)		{						var arr:Array = SWFAddress.getPathNames();			trace("\n\nMEDIA --- ADDRESS CHANGE name:"+e.value+" ARR: length:"+arr.length+" vals:"+arr[1]);			if(arr.length > 1){ 				refData(arr[1]);			}		}		 private function refData(ref:String)		{			trace("REFDATA:"+ref+" CURRENTSECTION:"+currentSection);						for(var i:int; i < dataXML.nav.elements().length(); i++){				//trace("-- id:"+navList.section[i].@id);				if(dataXML.nav.section[i].@id == ref){										trace(dataXML.nav.section[i].valueOf());					var vals:Array = [									  dataXML.nav.section[i].@id,									  dataXML.nav.section[i].valueOf()									  ];									}			}						if(ref != currentSection){				currentSection = ref;				loadSubLevel(vals[0]);				//SWFAddress.setTitle(("MEDIA :: "+vals[1]));			}		}				private function loadSubLevel(id:String)		{			trace("MEDIA - LOADSUBLEVEL:"+id);			if(currentContent){ 				currentContent.closeAction();				currentContent.parent.removeChild(currentContent);				currentContent = null;				for (var i:int; i < contentClip.numChildren; i++){					var mc:* = contentClip.getChildAt(i);					contentClip.removeChild(mc);					mc = null;				}			}						var sharetxt:String = dataXML.share_linkout.valueOf();			if(id == "videos"){				var mcv:videosContainer = new videosContainer();				contentClip.addChild(mcv);				mcv.init(dataXML.videos, sharetxt);				currentContent = mcv;			} else if(id == "screenshots"){				var mcs:screensContainer = new screensContainer();				contentClip.addChild(mcs)				mcs.init(dataXML.screenshots, sharetxt);				currentContent = mcs;			} /*else if(id == "wallpapers"){				var mcw:wallsContainer = new wallsContainer();				contentClip.addChild(mcw);				mcw.init(dataXML.wallpapers, sharetxt);				currentContent = mcw;			} else if(id == "icons"){				var mci:iconsContainer = new iconsContainer();				contentClip.addChild(mci);				mci.init(dataXML.icons, sharetxt);				currentContent = mci;			}*/					}				private function onRemoved(e:Event){				currentContent.closeAction();			SWFAddress.removeEventListener(SWFAddressEvent.CHANGE, addressChange);		}				/******************************************		XML		*******************************************/				private function loadData()		{			var dataURL:URLRequest = new URLRequest(xmlAsset);			var xmlLoader:URLLoader = new URLLoader(dataURL);			xmlLoader.addEventListener(Event.COMPLETE, xmlLoaded);			dataXML.ignoreWhitespace = true;			dataXML.ignoreProcessingInstructions;		} 							private function xmlLoaded(event:Event) 		{									dataXML = new XML(event.currentTarget.data);						var totalSections:Number = dataXML.elements().length();			trace("LOADDATA :: total K:"+event.currentTarget.bytesTotal);			trace("TOTAL FIRST NODES==================================================:"+totalSections); 									TweenLite.from(bgClip, .5, {x:-bgClip.width, ease:Bounce.easeOut, onComplete:initBG});			visible = true;		}			}}