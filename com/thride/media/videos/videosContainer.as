package com.thride.media.videos{	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.display.Loader;	import flash.display.Graphics;	import flash.display.Stage;		import flash.display.StageDisplayState;		import flash.text.TextField;	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.net.URLVariables;	import flash.net.URLRequestMethod;	import flash.net.URLLoaderDataFormat;		import flash.events.Event;	import flash.events.MouseEvent;		import flash.geom.Rectangle;    import flash.xml.XMLDocument;    import flash.xml.XMLNode;    import flash.xml.XMLNodeType;		import com.dynamicflash.util.Base64;	import com.thride.AudioEvent;	import com.thride.NavEvent;	import com.thride.Global;	import com.asual.swfaddress.*;	import gs.TweenLite;	import gs.easing.*;	//TweenLite.to(mc, 1, {x:46, y:43, scaleX:1, scaleY:1, rotation:0, alpha:1, tint:0x3399ff, ease:Elastic.easeOut, onComplete:FunctionName });			public class videosContainer extends MovieClip	{						public var currentSubSection:String;		public var dataXML:XMLList;						private var bgLoader:Loader;				public var thumbNavMC:VideosThumbNav;				private var linkoutTxt:String; //needs dynamics				private var prevButMC:MovieClip;		private var nextButMC:MovieClip;				private var shareButMC:MovieClip;		private var linkoutClip:MovieClip;		private var facebookBut:MovieClip;		private var twitterBut:MovieClip;		private var linkoutCloseBut:MovieClip;				public var isThumbOpen:Boolean = false;				public var vidPlayer:VPlayer;		public var vidLoader:Loader;				private var currentChoice:Number = 0;				private var titleTxt:TextField;		private var bodyTxt:TextField;				private var totalElements:Number;						public function videosContainer()		{			addEventListener(Event.ADDED_TO_STAGE, onAdded);		}				public function init($dataXML:XMLList, $sharetxt:String)		{			linkoutTxt = $sharetxt;			dataXML = $dataXML;			totalElements = dataXML.elements().length()			trace("VIDEOSCONTAINER : "+totalElements);			titleTxt = getChildByName("titletxt") as TextField;			bodyTxt = getChildByName("bodytxt") as TextField;			shareButMC = getChildByName("sharedyn") as MovieClip;			linkoutClip = getChildByName("linkout") as MovieClip;			facebookBut = linkoutClip.getChildByName("facebookdyn") as MovieClip;			twitterBut = linkoutClip.getChildByName("twitterdyn") as MovieClip;			linkoutCloseBut = linkoutClip.getChildByName("closebut") as MovieClip;						linkoutClip.visible = false;						initVideo();			checkDeepLink();		}								//*******************************************VPLAYER				private function initVideo()		{												//vidPlayer.init(asset, nextRequest);						thumbNavMC = getChildByName("thumbnav") as VideosThumbNav;						thumbNavMC.initThumbNav(dataXML, changeAction);			initShare();		}								private function initShare()		{			var asset:String = "img/"+Global.COUNTRY+"/media/share_icon.png";			var target:MovieClip = shareButMC;			var l = new Loader();			function finishload(e:Event){				shareButMC.addChild(e.currentTarget.content);				shareButMC.addEventListener(MouseEvent.CLICK, openShare);				shareButMC.buttonMode = true;				TweenLite.from(shareButMC, 1, {alpha:0, ease:Strong.easeOut});				trace("SHARE ASSET LOADED w:"+shareButMC.width);			}			l.contentLoaderInfo.addEventListener(Event.COMPLETE, finishload);			l.load(new URLRequest(asset));								var facebookimg:String = "img/"+Global.COUNTRY+"/link_facebook.png";			var facebookLoader:Loader = new Loader();			function initFaceBook(e:Event)			{				facebookBut.addChild(e.currentTarget.content);				facebookBut.buttonMode = true;				facebookBut.addEventListener(MouseEvent.CLICK, facebookAction);			}			facebookLoader.contentLoaderInfo.addEventListener(Event.COMPLETE, initFaceBook);			facebookLoader.load(new URLRequest(facebookimg));						var twitterimg:String = "img/"+Global.COUNTRY+"/link_twitter.png";			var twitterLoader:Loader = new Loader();			function initTwitter(e:Event)			{				twitterBut.addChild(e.currentTarget.content);				twitterBut.buttonMode = true;				twitterBut.addEventListener(MouseEvent.CLICK, twitterAction);			}			twitterLoader.contentLoaderInfo.addEventListener(Event.COMPLETE, initTwitter);			twitterLoader.load(new URLRequest(twitterimg));		}				private function openShare(e:MouseEvent){			//<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<FACEBOOK LINKS			linkoutClip.visible = true;			addChild(linkoutClip);			var txt:TextField = linkoutClip.getChildByName("titletxt") as TextField;			txt.htmlText = linkoutTxt;			linkoutCloseBut.addEventListener(MouseEvent.CLICK, closeLinkOut);			linkoutCloseBut.buttonMode = true;		}						private function twitterAction(e:MouseEvent){						var flip:Number = Math.abs(currentChoice - totalElements);			var url:String = "http://twitter.com/home?status=Check+Out+This+THRIDE+image+http://"+Global.DOMAIN + escape("/#/media/videos/")+flip;			dispatchEvent(new NavEvent(NavEvent.LINKOUT, true, true, url));			closeLinkOut(null);		}				private function facebookAction(e:MouseEvent){						var flip:Number = Math.abs(currentChoice - totalElements);			var url:String = "http://www.facebook.com/share.php?u=http://"+Global.DOMAIN + escape("/#/media/videos/")+flip;			dispatchEvent(new NavEvent(NavEvent.LINKOUT, true, true, url));			closeLinkOut(null);		}				private function closeLinkOut(e:MouseEvent){			linkoutClip.visible = false;		}						private function changeAction(num:Number)		{			var flip:Number = Math.abs(num - totalElements);			trace("VIDEO CONTAINER CHANGEACTION:"+num);			SWFAddress.setValue(("media/videos/"+flip))			//SWFAddress.setTitle(("MEDIA :: VIDEO:"+num));					}						public function changeVideo(num:Number)		{			if(vidPlayer) vidPlayer.closeAction();			vidPlayer = null;						assetTrack(dataXML.video[num].@asset);			vidPlayer = new VPlayer(dataXML.video[num].@asset, nextRequest);			addChild(vidPlayer);			vidPlayer.x = 224;			currentChoice = num;			trace("CONTAINER - CHANGE VIDEO:"+num);			//vidPlayer.changeVideo(num);			thumbNavMC.highlightThumb(num);			titleTxt.htmlText = dataXML.video[num].title.valueOf();			bodyTxt.htmlText = dataXML.video[num].copyblock.valueOf();		}						private function assetTrack($asset:String)		{			var sendObj:URLVariables = new URLVariables();			sendObj.a = Base64.encode($asset);			sendObj.s = Base64.encode("THRIDE");			sendObj.t = Base64.encode("video");			sendObj.c = Base64.encode(Global.COUNTRY);						var request:URLRequest = new URLRequest(Global.ASSETTRACK);			request.method = URLRequestMethod.POST;			request.data = sendObj;			 			var loader:URLLoader = new URLLoader();			loader.dataFormat = URLLoaderDataFormat.VARIABLES;			 			try{				loader.load(request);			}			catch (error:Error) {				trace("Unable to load URL:"+Global.ASSETTRACK);			}		}				private function addressChange(e:SWFAddressEvent)		{			var arr:Array = SWFAddress.getPathNames();						trace("\n\nMEDIA - VIDEOCONTAINER --- ADDRESS CHANGE name:"+e.value+" ARR: length:"+arr.length+" vals:"+arr[2]);			if(arr.length == 3){ 								var flip:Number = Math.abs(arr[2] - totalElements);				changeVideo(flip);			}					}				private function checkDeepLink()		{			SWFAddress.addEventListener(SWFAddressEvent.CHANGE, addressChange);			var arr:Array = SWFAddress.getPathNames();			trace("DEEPLINK : length:"+arr.length);			if(arr.length < 3){ 				SWFAddress.setValue("media/videos/"+totalElements);			} else {								var flip:Number = Math.abs(arr[2] - totalElements);				changeVideo(flip);			}		}										private function nextRequest(){			trace("======================NEXT REQUEST");			if( (currentChoice+1) < dataXML.elements().length()){				var index:Number = currentChoice+1;				changeAction(index);			} else {				changeAction(0);			}		}		private function prevRequest(){						if( (currentChoice-1) >= 0){				var index:Number = currentChoice - 1;				changeAction(index);			} else {								var index2:Number = (dataXML.elements().length()-1);				changeAction(index2);			}					}						private function onAdded(e:Event)		{			addEventListener(Event.REMOVED_FROM_STAGE, onRemoved);					stage.dispatchEvent(new AudioEvent(AudioEvent.TOGGLE, true, false, false));		}				public function closeAction()		{						vidPlayer.closeAction();			vidPlayer = null;		}				private function onRemoved(e:Event){							stage.dispatchEvent(new AudioEvent(AudioEvent.TOGGLE, true, false, true));			SWFAddress.removeEventListener(SWFAddressEvent.CHANGE, addressChange);			delete this;		}			}}